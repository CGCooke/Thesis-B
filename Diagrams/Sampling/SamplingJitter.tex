
\tikzset{
block/.style = {draw, fill=white, rectangle, minimum height=3em, minimum width=3em},
tmp/.style  = {coordinate}, 
sum/.style= {draw, fill=white, circle, node distance=1cm},
input/.style = {coordinate},
output/.style= {coordinate},
pinstyle/.style = {pin edge={to-,thin,black}
}
}

\begin{figure}[!htb]
\centering
\begin{tikzpicture}[auto, node distance=2cm,>=latex']

%\draw[dotted](-3,0.25) node {Coherent samples};
%\draw[dotted](-3,-1.5) node {Incoherent integration};
%\draw[dotted](-3,-3.5) node {Frequencies};


\draw[->] (1,1) -- (1,0.5);
\draw[->] (3,1) -- (3,0.5);
\node at (1,1.2) {$\phi_1$};
\node at (3,1.2) {$\phi_2$};


\foreach \x in {0,...,7}{
    \draw [fill=orange] (0.5*\x,0) rectangle (0.5*\x+0.5,0.5);
}


\foreach \x in {0,...,7}{
    \draw [fill=orange] (0.5*\x+9,0) rectangle (0.5*\x+0.5+9,0.5);
}


\node at (4.5,0) {\ldots};


\foreach \x in {0,...,1}{
    \draw [fill=blue] (2*\x,-1) rectangle (2*\x+2,-2);
}

\draw [fill=teal] (0,-3) rectangle (4,-4);


\foreach \x in {0,...,1}{
    \draw [decorate,decoration={brace,amplitude=0.4cm,mirror},xshift=0,yshift=0pt]
(2*\x,0) -- (2*\x+2,0) node [black,midway]{};
    \draw[->] (2*\x+1,-0.4) -- (2*\x+1,-1);
}


\draw [decorate,decoration={brace,amplitude=0.5cm,mirror},xshift=0,yshift=0pt]
(0,-2) -- (4,-2) node [black,midway]{};
\draw[->] (2,-2.5) -- (2,-3);


\draw[->] (4,-4) -- (4,-5);
\draw [fill=purple] (4,-5) rectangle (5.5,-6);
\node at (4.75,-5.5) {Jitter};


\draw[->] (5.5,-6) -- (5.5,-7);
\draw [fill=yellow] (5.5,-7) rectangle (7.5,-8);
\node at (6.5,-7.25) {Tracking};
\node at (6.5,-7.75) {Loop};


\draw[->] (7.5,-8) -- (7.5,-9);
\draw [fill=purple] (7.5,-9) rectangle (9,-10);
\node at (8.25,-9.5) {Jitter};

\draw[->] (9,-9) -- (9,0);
\node at (10.5,-0.5) {Update NCO};


\draw [decorate,decoration={brace,amplitude=0.4cm},xshift=0,yshift=0pt]
(3,0.5) -- (9,0.5) node [black,midway]{};

%\draw[->] (9,1.5) -- (9,0.5);
\node at (6,1.2) {Delay};


\end{tikzpicture}
\caption{Once a pair of 4ms coherently integrated samples has been collected, then the tracking loops can compute a new value for the NCO. During this process, delays accrue due to the interrupt driven nature of the processor, as well as processing time for the tracking loops.}
\label{fig:SamplingJitter}
\end{figure}




